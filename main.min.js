function loadSample(){simplemde.value(sampleText)}function loadBackup(){chrome.storage.local.get("value",function(a){simplemde.value(a.value)})}function openFile(){var a=[{mimeTypes:["markdown/*"],extensions:["md","txt"]}];chrome.fileSystem.chooseEntry({accepts:a},function(a){return chrome.runtime.lastError?void showError(chrome.runtime.lastError.message):(setEntry(a,!1),replaceDocContentsFromFileEntry(),void chrome.storage.local.set({chosenFile:chrome.fileSystem.retainEntry(a)}))})}function replaceDocContentsFromFile(a){var b=new FileReader;b.onload=function(){simplemde.value(b.result)},b.readAsText(a)}function replaceDocContentsFromFileEntry(){fileEntry.file(replaceDocContentsFromFile)}function saveAsFile(){var a={type:"saveFile",suggestedName:"my-file.md"};chrome.fileSystem.chooseEntry(a,function(a){setEntry(a,!0),chrome.storage.local.set({chosenFile:chrome.fileSystem.retainEntry(a)}),a.createWriter(function(a){a.write(new Blob([simplemde.value()],{type:"text/plain"})),activateToast()})})}function setEntry(a,b,c){fileEntry=a,gotWritable=b}function saveFile(){gotWritable?saveToEntry():fileEntry?chrome.fileSystem.getWritableEntry(fileEntry,function(a){return chrome.runtime.lastError?void showError(chrome.runtime.lastError.message):(setEntry(a,!0),void saveToEntry())}):saveAsFile()}function loadFileEntry(a){chosenEntry=a,chosenEntry.file(function(a){readAsText(chosenEntry,function(a){simplemde.value(a)})})}function readAsText(a,b){a.file(function(a){var c=new FileReader;c.onload=function(a){b(a.target.result)},c.readAsText(a)})}function loadInitialFile(a){a&&a.items&&a.items[0]?loadFileEntry(a.items[0].entry):chrome.storage.local.get("chosenFile",function(a){a.chosenFile?(gotWritable=!0,chrome.fileSystem.isRestorable(a.chosenFile,function(b){console.info("Restoring "+a.chosenFile),chrome.fileSystem.restoreEntry(a.chosenFile,function(a){a&&loadFileEntry(a)})})):gotWritable=!1})}function saveToEntry(){gotWritable?chosenEntry.createWriter(function(a){var b=new Blob([simplemde.value()],{type:"text/plain"});a.write(b),activateToast()}):fileEntry.createWriter(function(a){var b=new Blob([simplemde.value()],{type:"text/plain"});a.write(b),activateToast()})}function saveAsHTML(){exportHTML=!0;var a=simplemde.options.previewRender(simplemde.value()),b={type:"saveFile",suggestedName:"my-file.html"};chrome.fileSystem.chooseEntry(b,function(b){setEntry(b,!0),b.createWriter(function(b){b.write(new Blob([a],{type:"text/plain"})),activateToast()})}),exportHTML=!1}function activateToast(){"use strict";var a={message:"File Saved!"};snackbarContainer.MaterialSnackbar.showSnackbar(a)}function saveChanges(){chrome.storage.local.set({value:theValue},function(){})}function openDirectoryImage(){chrome.fileSystem.chooseEntry({},function(a){a.file(function(a){var b=URL.createObjectURL(a);localURL=b,simplemde.drawImage(),localImage=!1})})}function getOnlineBlob(a){var b=new XMLHttpRequest;b.open("GET",a,!0),b.responseType="blob",b.onload=function(a){onlineURL=window.URL.createObjectURL(this.response),simplemde.drawImage(),onlineImage=!1},b.send()}var initialMarkdown="",theValue,badConnection=!1,localImage=!1,onlineImage=!1,localURL,onlineURL,sampleText="### Welcome to Material Markdown!\n**Shortcuts**\n- Load Sample Page: Ctrl+P\n- Open File: Ctrl+O\n- Save File: Ctrl+S\n- Toggle Blockquote: Ctrl+'\n- Toggle Bold: Ctrl+B\n- Toggle Italic: Ctrl+I\n- Draw Link: Ctrl+K\n- Toggle Unordered List: Ctrl+L\n-----\n```\nvar test = 'hello from material markdown'\n```\n[Gitlab Repository](https://gitlab.com/bernardodsanderson/material-markdown)\n> This app uses the open source SimpleMDE markdown editor",simplemde=new SimpleMDE({element:document.getElementById("my-content"),spellChecker:!1,toolbar:["bold","italic","strikethrough","|","quote","unordered-list","ordered-list","clean-block","table","|","heading-1","heading-2","heading-3","heading-smaller","heading-bigger","|","code","link",{name:"image",action:console.log("online image"),className:"fa fa-picture-o",title:"Online Image"},{name:"local",action:console.log("local image"),className:"fa fa-file-image-o",title:"Local Image"},"horizontal-rule","|","side-by-side"],initialValue:initialMarkdown,status:!1});simplemde.toggleSideBySide(),simplemde.toggleSideBySide(),$('<button id="demo-menu-lower-right" class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons" style="color: white;">more_vert</i></button>').appendTo(".editor-toolbar"),$(".mdl-menu li").on("click",function(){switch($(this)[0]){case $("#open_file")[0]:openFile();break;case $("#save")[0]:saveFile();break;case $("#save_as")[0]:saveAsFile();break;case $("#load_sample")[0]:loadSample();break;case $("#get_html")[0]:saveAsHTML();break;case $("#restore")[0]:loadBackup();break;default:console.log("Nothing selected")}});var chosenFileEntry=null,fileEntry,gotWritable=!1;loadInitialFile(launchData);var exportHTML=!1;document.addEventListener("keydown",function(a){a.ctrlKey&&83==a.keyCode?saveFile():a.ctrlKey&&79==a.keyCode?openFile():a.ctrlKey&&80==a.keyCode&&loadSample()},!0);var snackbarContainer=document.querySelector("#demo-toast-example");simplemde.codemirror.on("change",function(){theValue=simplemde.value(),saveChanges()}),chrome.contextMenus.create({id:"open-file",title:"Open File",contexts:["launcher","all"]},function(){console.log(chrome.runtime.lastError)}),chrome.contextMenus.create({id:"save-file",title:"Save",contexts:["launcher","all"]},function(){console.log(chrome.runtime.lastError)}),chrome.contextMenus.create({id:"save-as-file",title:"Save As",contexts:["launcher","all"]},function(){console.log(chrome.runtime.lastError)}),chrome.contextMenus.create({id:"save-html",title:"Get HTML",contexts:["launcher","all"]},function(){console.log(chrome.runtime.lastError)}),chrome.contextMenus.create({id:"load-sample",title:"Load Sample Page",contexts:["launcher","all"]},function(){console.log(chrome.runtime.lastError)}),chrome.contextMenus.create({id:"restore",title:"Restore Backup",contexts:["launcher","all"]},function(){console.log(chrome.runtime.lastError)}),chrome.contextMenus.onClicked.addListener(function(a){"save-file"==a.menuItemId&&saveFile(),"open-file"==a.menuItemId&&openFile(),"save-as-file"==a.menuItemId&&saveAsFile(),"load-sample"==a.menuItemId&&loadSample(),"save-html"==a.menuItemId&&saveAsHTML(),"restore"==a.menuItemId&&loadBackup()}),$("a.fa.fa-file-image-o").on("click",function(){localImage=!0,openDirectoryImage()});var dialog=document.querySelector("dialog");$("a.fa.fa-picture-o").on("click",function(){dialog.showModal()}),dialog.querySelector("button.button-submit").addEventListener("click",function(){onlineImage=!0,getOnlineBlob($("#online-image-url").val()),dialog.close()}),dialog.querySelector("button.close").addEventListener("click",function(){dialog.close()});